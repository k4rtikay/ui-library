{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "card-stack",
  "title": "Card Stack",
  "description": "A component providing a stack interaction.",
  "dependencies": [
    "motion"
  ],
  "files": [
    {
      "path": "registry/card-stack.tsx",
      "content": "\"use client\";\n\nimport { cn } from \"@/lib/utils\";\nimport React, { Children, useState, useRef, useEffect, useCallback } from \"react\";\nimport { motion, Transition } from \"motion/react\";\n\ntype CardOffset = {\n  scale: number;\n  y: number;\n  opacity?: number;\n}\n\ninterface CardStackProps extends React.HTMLAttributes<HTMLDivElement> {\n  children: React.ReactNode;\n  className?: string;\n\n  // Customization\n  offsets?: CardOffset[];\n  maxVisibleCards?: number;\n\n  // Animation\n  transition?: Transition;\n  exitOffset?: number;\n  exitBlur?: number;\n\n  // Behavior\n  autoAdvance?: boolean;\n  autoAdvanceInterval?: number;\n  pauseOnHover?: boolean;\n\n  // Control\n  activeIndex?: number;\n  onIndexChange?: (index: number) => void;\n\n  // Interaction\n  clickable?: boolean;\n  keyboardNavigable?: boolean;\n}\n\nconst DEFAULT_OFFSETS: CardOffset[] = [\n  { scale: 1, y: 0, opacity: 1 },      // top card\n  { scale: 0.95, y: 12, opacity: 1 },  // second card\n  { scale: 0.9, y: 24, opacity: 1 },   // third card\n];\n\nexport function CardStack({\n  children,\n  className,\n  offsets = DEFAULT_OFFSETS,\n  maxVisibleCards = 3,\n  transition = { type: \"spring\", damping: 21, stiffness: 180 },\n  exitOffset = -64,\n  exitBlur = 4,\n  autoAdvance = false,\n  autoAdvanceInterval = 5000,\n  pauseOnHover = true,\n  activeIndex: controlledIndex,\n  onIndexChange,\n  clickable = true,\n  keyboardNavigable = true,\n  ...props\n}: CardStackProps) {\n  const cards = Children.toArray(children);\n  const totalCards = cards.length;\n\n  // Internal state for uncontrolled mode\n  const [internalIndex, setInternalIndex] = useState(0);\n  const [hasInteracted, setHasInteracted] = useState(false);\n  const [isPaused, setIsPaused] = useState(false);\n\n  const isControlled = controlledIndex !== undefined;\n  const activeIndex = isControlled ? controlledIndex : internalIndex;\n\n  const cardsRef = useRef<(HTMLDivElement | null)[]>([]);\n  const isKeyRef = useRef(false);\n  const autoAdvanceTimerRef = useRef<NodeJS.Timeout>(null);\n\n  // Edge cases\n  if (totalCards === 0) return null;\n  if (totalCards === 1) {\n    return (\n      <div className={cn(\"relative\", className)} {...props}>\n        <div className=\"relative\">{cards[0]}</div>\n      </div>\n    );\n  }\n\n  const maxOffset = Math.max(\n    0,\n    ...offsets.slice(0, maxVisibleCards).map(offset => offset.y)\n  );\n\n  const lastIndex = (activeIndex - 1 + totalCards) % totalCards;\n\n  const handleNext = useCallback(() => {\n    const newIndex = (activeIndex + 1) % totalCards;\n\n    if (!isControlled) {\n      setInternalIndex(newIndex);\n    }\n\n    onIndexChange?.(newIndex);\n    setHasInteracted(true);\n  }, [activeIndex, totalCards, isControlled, onIndexChange]);\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (!keyboardNavigable) return;\n\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      isKeyRef.current = true;\n      handleNext();\n    } else if (e.key === \"ArrowRight\" || e.key === \"ArrowDown\") {\n      e.preventDefault();\n      isKeyRef.current = true;\n      handleNext();\n    } else if (e.key === \"ArrowLeft\" || e.key === \"ArrowUp\") {\n      e.preventDefault();\n      isKeyRef.current = true;\n      const prevIndex = (activeIndex - 1 + totalCards) % totalCards;\n\n      if (!isControlled) {\n        setInternalIndex(prevIndex);\n      }\n      onIndexChange?.(prevIndex);\n      setHasInteracted(true);\n    }\n  };\n\n  useEffect(() => {\n    if (!autoAdvance || isPaused) {\n      if (autoAdvanceTimerRef.current) {\n        clearInterval(autoAdvanceTimerRef.current);\n      }\n      return;\n    }\n\n    autoAdvanceTimerRef.current = setInterval(() => {\n      handleNext();\n    }, autoAdvanceInterval);\n\n    return () => {\n      if (autoAdvanceTimerRef.current) {\n        clearInterval(autoAdvanceTimerRef.current);\n      }\n    };\n  }, [autoAdvance, autoAdvanceInterval, isPaused, handleNext]);\n\n  // Focus management\n  useEffect(() => {\n    if (isKeyRef.current) {\n      const currentCard = cardsRef.current[activeIndex];\n      currentCard?.focus();\n      isKeyRef.current = false;\n    }\n  }, [activeIndex]);\n\n  const getCardVariant = (index: number) => {\n    const isTop = index === activeIndex;\n    const isExiting = index === lastIndex && hasInteracted;\n\n    if (isExiting) {\n      return {\n        y: exitOffset,\n        opacity: 0,\n        zIndex: 50,\n        filter: `blur(${exitBlur}px)`,\n        scale: offsets[0]?.scale || 1,\n        transition: { duration: 0.2 },\n      };\n    }\n\n    if (isTop) {\n      return {\n        ...offsets[0],\n        y: offsets[0]?.y || 0,\n        zIndex: 30,\n      };\n    }\n\n    const stackPosition = (index - activeIndex + totalCards) % totalCards;\n\n    if (stackPosition > 0 && stackPosition <= maxVisibleCards) {\n      const offsetIndex = Math.min(stackPosition, offsets.length - 1);\n      const offset = offsets[offsetIndex] || offsets[offsets.length - 1];\n\n      return {\n        scale: offset.scale,\n        y: offset.y,\n        opacity: offset.opacity ?? 1,\n        zIndex: 30 - stackPosition * 10,\n      };\n    }\n\n    // Hidden cards\n    const lastOffset = offsets[offsets.length - 1];\n    return {\n      scale: lastOffset?.scale || 0.8,\n      y: exitOffset,\n      opacity: 0,\n      zIndex: 0,\n    };\n  };\n\n  const handleMouseEnter = () => {\n    if (pauseOnHover) {\n      setIsPaused(true);\n    }\n  };\n\n  const handleMouseLeave = () => {\n    if (pauseOnHover) {\n      setIsPaused(false);\n    }\n  };\n\n  return (\n    <div\n      className={cn(\"relative flex flex-col justify-end \", className)}\n      style={{\n        marginBottom: maxOffset,\n      }}\n      onMouseEnter={handleMouseEnter}\n      onMouseLeave={handleMouseLeave}\n      role=\"region\"\n      aria-label=\"Card stack\"\n      aria-live=\"polite\"\n      {...props}\n    >\n      {cards.map((item, index) => {\n        const isTop = index === activeIndex;\n        const variant = getCardVariant(index);\n\n        return (\n          <motion.div\n            key={index}\n            ref={(el) => {\n              cardsRef.current[index] = el;\n            }}\n            initial={variant}\n            animate={variant}\n            transition={transition}\n            whileTap={clickable && isTop ? { y: `${(offsets[0]?.y || 0) + 6}px` } : undefined}\n            className={cn(\n              \"absolute inset-0 outline-none group\",\n              {\n                \"pointer-events-none\": !isTop,\n                \"cursor-pointer select-none\": clickable && isTop,\n              }\n            )}\n            onClick={() => {\n              if (!clickable || !isTop) return;\n              isKeyRef.current = false;\n              handleNext();\n            }}\n            tabIndex={isTop && (clickable || keyboardNavigable) ? 0 : -1}\n            onKeyDown={handleKeyDown}\n            role={clickable ? \"button\" : undefined}\n            aria-label={`Card ${index + 1} of ${totalCards}`}\n            aria-current={isTop ? \"true\" : undefined}\n          >\n            {item}\n          </motion.div>\n        );\n      })}\n\n      {/* Screen reader announcement */}\n      <div className=\"sr-only\" aria-live=\"polite\" aria-atomic=\"true\">\n        Showing card {activeIndex + 1} of {totalCards}\n      </div>\n    </div>\n  );\n}\n\nexport function CardStackIndicator({\n  totalCards,\n  activeIndex,\n}: {\n  totalCards: number;\n  activeIndex: number;\n}) {\n  return (\n    <div className=\"flex items-center gap-2\">\n      {Array.from({ length: totalCards }).map((_, index) => (\n        <div\n          key={index}\n          className={cn(\n            \"h-[4px] w-[4px] rounded-full transition-all duration-300\",\n            index === activeIndex ? \"bg-primary w-[12px]\" : \"bg-neutral-300 dark:bg-neutral-700\"\n          )}\n        />\n      ))}\n    </div>\n  );\n}",
      "type": "registry:component"
    }
  ],
  "type": "registry:ui"
}